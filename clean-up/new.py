# -*- coding: utf-8 -*-
"""
Created on Thu May 19 17:35:48 2022

@author: singh
"""


from SmartApi import SmartConnect 
# from SmartApi.smartWebSocketV2 import SmartWebSocketV2
# import requests
# req= requests.get("ws://smartapisocket.angelone.in/smart-stream")

from SmartApi import SmartWebSocket

obj=SmartConnect(api_key="YH7jX695")
data = obj.generateSession("D104396","diljot2001")
print(data)
AUTH_TOKEN = data["data"]["jwtToken"] 
API_KEY = 'YH7jX695'
CLIENT_CODE = 'D104396'
refreshToken= data['data']['refreshToken']

# feedToken = obj.feed_token

FEED_TOKEN = '0924907368'

correlation_id = "rallybaaz_feed"
action = 1
mode = 1



# token_list = [{"exchangeType": 2, "tokens": ["11909","4668","5114","14838","12034","11262","436","21154","6568","4378","1333","3127","15184","907","10074","11876","7979","4907","6803","4014","4055","1681","10588","2320","13710","6713","11082","4433","17","1508","11058","11813","3345","9436","5650","14223","4892","10940","18921","11549","2454","6944","3021","10717","3608","25023","13295","17881","11905","3321","14346","1672","12018","3088","3688","31468","3426","14942","10932","13801","17933","1330","11427","23650","3912","4843","2997","2275","15228","18039","1838","144","18962","3834","7048","3403","2406","19401","2969","6445","3507","15032","11593","24538","13187","11411","27008","10993","13951","6973","15244","14793","1515","13735","4671","11140","11032","13211","27297","2331","18827","14889","15355","3694","7451","2739","13786","21017","11809","1927","4870","958","18431","822","18284","8054","12686","14922","583","2385","6961","17603","4809","18931","14557","17272","6994","17256","1406","14957","3761","19937","7420","11386","10577","17468","11739","13796","17651","11439","7358","11301","19235","11543","1412","1979","3807","20532","13290","15419","10948","11915","18226","11373","11606","359","592","11596","15039","14208","1181","11480","21740","1153","11293","7229","10599","2142","18086","2866","9889","2168","18292","16045","2979","11957","14485","1011","5475","18110","11460","1507","7886","10755","21770","30835","10188","11027","20224","3150","27067","12009","15174","11773","9668","1663","2435","19556","5633","22377","11581","13966","21508","21195","15883","5359","140","7929","17875","6018","19438","7401","4973","10604","11271","11987","993","31138","3375","1008","2998","14299","13251","17477","8341","2496","25190","14203","13275","8657","21091","17357","29050","1336","3703","14096","13816","18977","5366","1315","3357","13693","3417","1023","24225","19036","10738","4822","6600","13337","13076","4172","8153","2664","14712","14106","17839","1205","3252","13192","3626","14937","3812","1512","4344","19111","20698","14627","19292","13061","184","15337","3570","17069","5948","5911","6068","4279","3129","14672","21469","79","31415","5162","13305","17029","1476","8632","11884","740","7852","2489","1424","6757","7325","15399","10939","8304","11625","5688","21427","15362","11155","4587","8424","24265","7105","1100","21423","2472","9385","14992","13587","17999","18142","2513","7200","547","154","3138","34","11655","2909","13","17094","11852","14245","8182","16913","20321","6943","11265","14597","625","19277","6040","5200","13400","7627","7053","8546","13585","1085","2112","14912","2643","13352","25574","11971","25136","20134","19800","11491","9917","981","5748","19104","157","11880","5428","937","11782","8687","19126","21957","15330","4064","14612","21551","335","6164","4204","13538","17279","3162","13702","15002","3172","11511","4920","7339","7","13528","471","14058","11394","16795","18967","18497","11446","1235","6643","1964","4747","11483","6848","14687","11580","385","9921","3273","27095","9158","2970","940","14853","8083","11536","20642","2627","17691","5585","16783","15360","2616","5279","9039","14356","4","1415","2844","11979","14003","2048","578","20296","19531","11703","29877","7145","3963","5507","21511","22255","3563","1145","8266","1041","14602","17586","7965","18391","2056","16821","4037","17105","104","7276","13810","17903","10473","19205","9641","18214","21683","2562","5352","14014","8132","1134","4992","13870","1348","1494","17376","2202","8771","19931","13890","11872","419","2492","24403","20419","742","509","22","30125","11919","16745","3987","203","6045","7030","20776","8342","236","31234","2514","19211","25492","30012","13236","7553","11763","11626","10181","23804","10999","8146","13643","19265","14667","21252","8311","27303","3275","13761","559","5373","1628","7390","4522","4430","14111","3938","9260","2595","14413","17939","48","1480","10511","11864","8024","10238","5220","2687","913","1360","1186","16807","11689","18365","18992","1363","270","24595","10310","2723","14771","2124","3547","17527","3329","25392","3546","8124","18822","16669","11287","11522","9309","3066","7518","14278","1919","14732","17922","30089","7303","8469","522","11435","2868","1038","13982","31837","21713","9931","14562","5186","21332","21541","7560","426","21623","2106","21399","10453","11892","2442","16639","19410","13839","8696","8075","220","1521","13091","2181","17270","13611","15129","9253","21339","13826","926","1485","5501","399","14101","25684","6718","10530","14947","11212","25340","1627","7196","18208","3024","5394","15308","24532","16222","18011","13920","16253","18202","17632","1994","3389","4491","19599","3411","10922","13536","7672","18564","21828","8175","13035","11630","5258","8591","13941","24196","20560","14908","3634","3348","19061","3493","16819","28906","1949","29850","22423","19184","11045","22277","13598","21254","20196","13859","5245","20223","641","19322","1442","3715","10397","3757","3496","7109","18371","3484","14174","1250","2463","1937","17295","24190","23452","9168","2794","1267","10300","10990","20790","13673","14339","19234","8736","15049","1726","17044","14858","2799","11471","4598","3292","513","10578","1129","1168","3351","7353","1901","11399","14848","13491","20446","7016","3126","14657","30108","3103","30023","21484","2176","19761","4751","11355","425","3396","20188","7218","14319","4410","17046","1455","20852","3405","2783","17794","22602","14309","17851","16395","13147","17685","14445","22239","166","5751","5701","14977","16845","7791","11927","14547","24870","2004","308","13086","2183","3499","4221","1162","10285","5926","21704","14813","21131","11840","10579","3387","1389","148","6422","16292","17388","739","17364","100","11006","4963","16719","2963","11965","16589","13285","330","17625","25512","17818","17971","29113","11050","14501","3063","5516","2289","3906","20242","8998","15199","2256","7838","324","1044","20374","6232","11364","16908","5265","1394","13300","13998","5631","3672","9539","20825","16713","18581","2837","6733","317","17130","15347","18096","3339","14019","4656","3745","637","15229","11634","11821","5143","15083","14008","3001","8167","11817","19","1756","29008","1127","3736","14218","9847","804","7851","4176","3466","404","10557","20302","15179","3980","11441","24999","16683","3799","25608","16921","16725","13066","11647","30392","3748","13511","14972","13270","16915","17702","3481","919","14043","13501","7406","8654","12716","18895","10406","7982","7603","2475","9348","703","3908","4179","10753","3880","17541","193","4986","16751","14361","21951","13844","13648","22233","13577","7844","5449","16123","15119","7880","4422","20906","27161","1214","305","17764","18889","13771","1232","10666","11743","3766","5378","757","1624","17486","11496","6353","393","31475","11829","685","5313","11935","1204","206","11275","1174","368","13116","16965","7862","18102","14428","15254","13620","6066","17945","13162","2614","4529","17752","3506","6218","967","4184","7927","7780","805","6006","3327","4041","20080","12022","277","30752","212","13740","25640","17770","10580","5610","24292","1190","13821","7508","10618","4040","14490","9007","1720","20159","11999","1597","20830","11856","7936","14702","4898","11226","14707","7919","4684","4503","16852","8119","928","24385","2043","881","19525","263","25756","18479","357","17659","13776","14450","25780","4934","4953","1630","1482","4957","6818","3186","9819","5239"]}]
token_list = [{"exchangeType": 1, "tokens": ["1330","11427"]}, {"exchangeType": 2, "tokens": ["1330","11427"]}]

sws = SmartWebSocket( API_KEY, FEED_TOKEN)


def on_data(wsapp, message):
    print("Ticks: {}".format(message))


def on_open(wsapp):
    print("on open")
    sws.subscribe(correlation_id, mode, token_list)


def on_error(wsapp, error):
    print(error)


def on_close(wsapp):
    print("Close")


# Assign the callbacks.
sws.on_open = on_open
sws.on_data = on_data
sws.on_error = on_error
sws.on_close = on_close

sws.connect()








